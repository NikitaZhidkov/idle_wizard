<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Wizard Duels</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="game-container">
        <div class="tabs">
            <button class="tab active" data-tab="battle">âš”ï¸ Duel</button>
            <button class="tab" data-tab="spellbook">ğŸ“œ Spells</button>
            <button class="tab" data-tab="skills">ğŸ“š Studies</button>
            <button class="tab" data-tab="shop">ğŸª Diagon</button>
            <button class="tab" data-tab="bestiary">ğŸ“– Creatures</button>
        </div>

        <div class="header">
            <div>
                <div class="galleons" id="gold">0 Galleons</div>
                <div class="gems" id="gems">0 Sickles | <span id="skillPoints">0 XP</span></div>
            </div>
            <div style="text-align: right;">
                <div class="level" id="level">Year 1</div>
                <div class="level" id="floor">Floor: 1</div>
            </div>
        </div>

        <!-- Battle Tab -->
        <div class="tab-content active" id="tab-battle">
            <div class="battle-area" id="battleArea">
                <div class="room-background" id="roomBackground"></div>
                <div class="magic-particles" id="magicParticles"></div>
                <div class="battle-info">
                    <div class="floor-display" id="floorDisplay"></div>
                    <div class="combo-display" id="comboDisplay"></div>
                </div>
                <div class="creature-status" id="creatureStatus"></div>
                <div class="fighters">
                    <div class="character" style="position: relative;">
                        <div class="character-name">Wizard</div>
                        <div class="health-bar-container"><div class="health-bar player" id="playerHealth"></div></div>
                        <canvas id="heroCanvas" class="character-sprite" width="55" height="75"></canvas>
                    </div>
                    <!-- Creature Display -->
                    <div class="character" id="battleCreatureCard">
                        <div class="character-name" id="battleCreatureName">Pixie</div>
                        <div class="health-bar-container"><div class="health-bar enemy" id="creatureHealth"></div></div>
                        <canvas id="creatureCanvas" class="enemy-sprite" width="50" height="60"></canvas>
                        <!-- Hidden elements for compatibility -->
                        <span id="battleCreatureType" style="display:none;"></span>
                        <span id="battleCreatureAbilities" style="display:none;"></span>
                        <span id="battleHpFill" style="display:none;"></span>
                        <span id="battleCreatureHp" style="display:none;"></span>
                        <span id="battleCreatureAtk" style="display:none;"></span>
                        <span id="battleCreatureWeak" style="display:none;"></span>
                        <span id="creatureMagic" style="display:none;"></span>
                    </div>
                </div>
                <!-- Hidden elements for compatibility -->
                <div id="creatureName" style="display:none;">Pixie</div>
                <div class="ground" id="roomGround"></div>
                <div class="room-transition" id="roomTransition">
                    <div class="room-victory">âœ¨ Victory! âœ¨</div>
                    <div class="room-loot" id="roomLoot">+0 Galleons</div>
                    <div class="room-next" id="roomNext">Room 2 awaits...</div>
                </div>
            </div>

            <div class="house-display" id="houseDisplay" style="text-align: center; margin-bottom: 4px;">
                <span id="currentHouseIcon" style="font-size: 20px;">ğŸ¦</span>
                <span id="currentHouseName" style="font-size: 12px; color: #ffd700;"></span>
            </div>

            <div class="active-buffs" id="activeBuffs"></div>

            <div class="spells" id="spellsContainer"></div>
            <div class="battle-log" id="battleLog"></div>
            <div class="stats">
                <div class="stat"><div class="stat-value" id="atkStat">10</div><div class="stat-label">MAGIC</div></div>
                <div class="stat"><div class="stat-value" id="defStat">5</div><div class="stat-label">SHIELD</div></div>
                <div class="stat"><div class="stat-value" id="critStat">5%</div><div class="stat-label">CRIT</div></div>
                <div class="stat"><div class="stat-value" id="hpStat">100</div><div class="stat-label">HP</div></div>
            </div>

            <!-- Buff Selection (shown after victory, below game area) -->
            <div class="buff-selection-panel" id="buffSelectionPanel" style="display: none;">
                <div class="buff-title">ğŸ Choose a reward:</div>
                <div class="buff-choices" id="buffChoices"></div>
            </div>

            <!-- Boss Shield Minigame -->
            <div class="shield-minigame" id="shieldMinigame">
                <div class="shield-title" id="shieldTitle">ğŸ›¡ï¸ Block the incoming spell!</div>
                <div class="shield-incoming" id="shieldIncoming">
                    <span class="shield-player-icon">ğŸ§™</span>
                    <span class="shield-enemy-icon" id="shieldEnemyIcon">ğŸ§Œ</span>
                </div>
                <div class="shield-buttons" id="shieldButtons">
                    <button class="shield-btn red" data-color="red">ğŸ”¥</button>
                    <button class="shield-btn blue" data-color="blue">ğŸ’§</button>
                    <button class="shield-btn yellow" data-color="yellow">âš¡</button>
                    <button class="shield-btn green" data-color="green">ğŸŒ¿</button>
                </div>
                <div class="shield-timer"><div class="shield-timer-bar" id="shieldTimerBar"></div></div>
                <div class="shield-result" id="shieldResult"></div>
                <div class="shield-hint" id="shieldHint"></div>
            </div>
        </div>

        <!-- Shield Tutorial Overlay -->
        <div class="shield-tutorial-overlay" id="shieldTutorialOverlay" style="display: none;">
            <div class="shield-tutorial-content">
                <div class="shield-tutorial-title">ğŸ›¡ï¸ Shield Magic Tutorial</div>
                <div class="shield-tutorial-text">
                    The boss is casting spells at you!<br><br>
                    Watch the <b>color</b> of the incoming spell and <b>tap the matching shield button</b> to block it!
                </div>
                <div class="shield-tutorial-demo">
                    <div class="shield-tutorial-demo-btn" style="background: linear-gradient(135deg, #8a3030, #a04040);">ğŸ”¥</div>
                    <div class="shield-tutorial-demo-btn" style="background: linear-gradient(135deg, #303080, #4040a0);">ğŸ’§</div>
                    <div class="shield-tutorial-demo-btn" style="background: linear-gradient(135deg, #807830, #a09040);">âš¡</div>
                    <div class="shield-tutorial-demo-btn" style="background: linear-gradient(135deg, #308030, #40a040);">ğŸŒ¿</div>
                </div>
                <div class="shield-tutorial-arrow">â¬‡ï¸ Tap the matching color! â¬‡ï¸</div>
                <div class="shield-tutorial-text" style="font-size: 12px; color: #a0a0a8;">
                    The correct button will <b>glow</b> during this tutorial.<br>
                    Block all spells for bonus damage!
                </div>
                <button class="shield-tutorial-btn" id="shieldTutorialStartBtn">Got it! Let's go!</button>
            </div>
        </div>

        <!-- Spell Tutorial Overlay (beginning of game) -->
        <div class="spell-tutorial-overlay" id="spellTutorialOverlay" style="display: none;">
            <div class="spell-tutorial-content">
                <!-- Page 1: Welcome -->
                <div class="spell-tutorial-page active" id="spellTutorialPage1">
                    <div class="spell-tutorial-title">ğŸ§™ Welcome, Young Wizard!</div>
                    <div class="spell-tutorial-text">
                        Your journey at Hogwarts begins now!<br>
                        Let me teach you how to cast spells in battle.
                    </div>
                    <div style="font-size: 60px; margin: 20px 0;">âš”ï¸ğŸª„âœ¨</div>
                    <div class="spell-tutorial-text" style="color: #a0a0a8; font-size: 12px;">
                        You'll fight magical creatures automatically,<br>but spells give you special powers!
                    </div>
                    <button class="spell-tutorial-btn" onclick="nextSpellTutorialPage()">Next â†’</button>
                    <div class="spell-tutorial-dots">
                        <div class="spell-tutorial-dot active"></div>
                        <div class="spell-tutorial-dot"></div>
                        <div class="spell-tutorial-dot"></div>
                    </div>
                </div>

                <!-- Page 2: Attack Spells -->
                <div class="spell-tutorial-page" id="spellTutorialPage2">
                    <div class="spell-tutorial-title">âš¡ Attack Spells</div>
                    <div class="spell-tutorial-step">
                        <div class="spell-tutorial-step-title">ğŸ’¥ Deal Extra Damage</div>
                        <div class="spell-tutorial-step-text">
                            Tap a spell button to cast it!<br>
                            Attack spells deal damage and apply effects like <b>stun</b>, <b>burn</b>, or <b>poison</b>.
                        </div>
                    </div>
                    <div class="spell-tutorial-demo">
                        <div class="spell-tutorial-spell highlight">âš¡</div>
                        <div class="spell-tutorial-arrow">â†’</div>
                        <div class="spell-tutorial-spell">ğŸ‰</div>
                        <div class="spell-tutorial-arrow">â†’</div>
                        <div style="font-size: 24px; color: #c07070;">-50 ğŸ’¥</div>
                    </div>
                    <div class="spell-tutorial-text" style="font-size: 11px; color: #a0a0a8;">
                        Each spell has a cooldown - wait before casting again!
                    </div>
                    <button class="spell-tutorial-btn" onclick="nextSpellTutorialPage()">Next â†’</button>
                    <div class="spell-tutorial-dots">
                        <div class="spell-tutorial-dot"></div>
                        <div class="spell-tutorial-dot active"></div>
                        <div class="spell-tutorial-dot"></div>
                    </div>
                </div>

                <!-- Page 3: Healing & Buffs -->
                <div class="spell-tutorial-page" id="spellTutorialPage3">
                    <div class="spell-tutorial-title">ğŸ’š Healing & Buffs</div>
                    <div class="spell-tutorial-step">
                        <div class="spell-tutorial-step-title">ğŸ›¡ï¸ Protect Yourself</div>
                        <div class="spell-tutorial-step-text">
                            Some spells <b>heal</b> you or give you <b>buffs</b>!<br>
                            Use them when your health is low or to boost your power.
                        </div>
                    </div>
                    <div class="spell-tutorial-demo">
                        <div class="spell-tutorial-spell highlight">ğŸ’š</div>
                        <div class="spell-tutorial-arrow">â†’</div>
                        <div class="spell-tutorial-spell">ğŸ§™</div>
                        <div class="spell-tutorial-arrow">â†’</div>
                        <div style="font-size: 24px; color: #70c070;">+30% â¤ï¸</div>
                    </div>
                    <div class="spell-tutorial-text" style="font-size: 11px; color: #a0a0a8;">
                        You'll unlock more spells as you progress!
                    </div>
                    <button class="spell-tutorial-btn" onclick="finishSpellTutorial()">Start Playing! âš”ï¸</button>
                    <div class="spell-tutorial-dots">
                        <div class="spell-tutorial-dot"></div>
                        <div class="spell-tutorial-dot"></div>
                        <div class="spell-tutorial-dot active"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Skills Tab -->
        <div class="tab-content" id="tab-skills">
            <div class="skill-tree">
                <div class="tree-header">
                    <div class="skill-points">Study Points: <span id="availableSP">0</span></div>
                </div>
                <div class="tree-paths" id="treePaths"></div>
            </div>
        </div>

        <!-- Shop Tab -->
        <div class="tab-content" id="tab-shop">
            <div class="shop">
                <div class="shop-title">ğŸª Diagon Alley</div>
                <div class="shop-items" id="shopItems"></div>
            </div>
        </div>

        <!-- Bestiary Tab -->
        <div class="tab-content" id="tab-bestiary">
            <div class="bestiary" id="bestiaryList"></div>
        </div>

        <!-- Spellbook Tab -->
        <div class="tab-content" id="tab-spellbook">
            <div class="spellbook">
                <div class="spellbook-title">ğŸ“œ Spellbook</div>
                <div class="spellbook-list" id="spellbookList"></div>
            </div>
        </div>
    </div>

    <div class="offline-popup" id="offlinePopup" style="display: none;">
        <div class="offline-content">
            <div class="offline-title">ğŸ¦‰ Owl Post!</div>
            <div class="offline-reward" id="offlineGold">+0 Galleons</div>
            <button class="offline-btn" id="offlineClaimBtn">Collect!</button>
        </div>
    </div>

    <div class="house-select-popup" id="houseSelectPopup" style="display: none;">
        <div class="house-select-content">
            <div class="house-select-title">ğŸ© The Sorting Hat</div>
            <div class="house-select-subtitle">Choose your house wisely, young wizard...</div>
            <div class="house-options">
                <div class="house-option" data-house="gryffindor">
                    <div class="house-option-icon">ğŸ¦</div>
                    <div class="house-option-name">Gryffindor</div>
                    <div class="house-option-bonus">+20% Attack, -10% Defense</div>
                    <div class="house-option-items">ğŸ—¡ï¸ Sword of Gryffindor</div>
                </div>
                <div class="house-option" data-house="slytherin">
                    <div class="house-option-icon">ğŸ</div>
                    <div class="house-option-name">Slytherin</div>
                    <div class="house-option-bonus">+10% Attack, +5% Crit</div>
                    <div class="house-option-items">ğŸ“¿ Slytherin Locket</div>
                </div>
                <div class="house-option" data-house="ravenclaw">
                    <div class="house-option-icon">ğŸ¦…</div>
                    <div class="house-option-name">Ravenclaw</div>
                    <div class="house-option-bonus">+8% Crit, +20% XP</div>
                    <div class="house-option-items">ğŸ‘‘ Ravenclaw Diadem</div>
                </div>
                <div class="house-option" data-house="hufflepuff">
                    <div class="house-option-icon">ğŸ¦¡</div>
                    <div class="house-option-name">Hufflepuff</div>
                    <div class="house-option-bonus">+15% HP, +10% Defense</div>
                    <div class="house-option-items">ğŸ† Hufflepuff Cup</div>
                </div>
            </div>
        </div>
    </div>

    <div class="gameover-popup" id="gameoverPopup" style="display: none;">
        <div class="gameover-content">
            <div class="gameover-title">â˜ ï¸ Defeated!</div>
            <div class="gameover-floor" id="gameoverFloor">Reached Floor 1</div>
            <div class="gameover-stats">
                <div>ğŸ—¡ï¸ Creatures defeated: <span id="gameoverKills">0</span></div>
                <div>ğŸ’° Gold earned: <span id="gameoverGold">0</span></div>
                <div>ğŸ”¥ Max combo: <span id="gameoverCombo">0</span></div>
            </div>
            <button class="gameover-btn" id="gameoverRetryBtn">Try Again</button>
        </div>
    </div>

    <div class="gameover-popup" id="victoryPopup" style="display: none;">
        <div class="gameover-content" style="border-color: #ffd700;">
            <div class="gameover-title" style="color: #ffd700;">âš¡ Victory! âš¡</div>
            <div class="gameover-floor" style="color: #ffd700;">You defeated Voldemort!</div>
            <div class="gameover-stats">
                <div>ğŸ—¡ï¸ Creatures defeated: <span id="victoryKills">0</span></div>
                <div>ğŸ’° Gold earned: <span id="victoryGold">0</span></div>
                <div>ğŸ”¥ Max combo: <span id="victoryCombo">0</span></div>
            </div>
            <button class="gameover-btn" id="victoryPlayAgainBtn" style="background: linear-gradient(to bottom, #ffd700, #cc9900);">Play Again</button>
        </div>
    </div>

    <script type="module" src="main.js"></script>
</body>
</html>
